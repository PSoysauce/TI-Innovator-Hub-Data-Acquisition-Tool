jQuery.fn.inputFilter=function(t){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",(function(){t(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}))},$("#settings-form input").inputFilter((function(t){return/^-{0,1}\d*\.{0,1}\d*$/.test(t)}));var ctx=document.getElementById("oscilloscopeChart").getContext("2d"),chart=new Chart(ctx,{type:"line",data:{datasets:[{label:"Voltage",pointStyle:"line",data:[],steppedLine:!1,fill:!1,borderColor:"rgb(14, 173, 105)"}]},options:{plugins:{zoom:{pan:{enabled:!0,mode:"x"},zoom:{enabled:!0,mode:"x"}}},title:{display:!0,text:"Oscilloscope",fontColor:"rgb(255, 255, 255)"},legend:{labels:{defaultFontFamily:"'Roboto', 'Franklin Gothic Medium', 'Tahoma', 'sans-serif",fontColor:"rgb(255, 255, 255)"}},color:"rgb(255, 255, 255)",scales:{yAxes:[{gridLines:{drawOnChartArea:!0,color:"rgb(255,255,255)"},ticks:{fontColor:"rgb(255, 255, 255)",beginAtZero:!0,callback:function(t,e,a){return t+" V"}},scaleLabel:{display:!0,labelString:"Voltage"},type:"linear"}],xAxes:[{gridLines:{drawOnChartArea:!1},ticks:{beginAtZero:!0,fontColor:"rgb(255, 255, 255)",beginAtZero:!0,callback:function(t,e,a){return t}},type:"realtime",scaleLabel:{display:!0,labelString:"Time"},realtime:{onRefresh:function(t){t.data.datasets.forEach((function(t){display_data&&t.data.push({x:Date.now(),y:plotSine()})}))},delay:2e3}}]}}}),x=1,frequency=1,amplitude=1,period=1/frequency,max_volt=0,min_volt=0;function updateVars(){frequency=(frequency=parseFloat($("#freq-input").val()))<=0?.01:frequency,amplitude=parseFloat($("#amplitude-input").val())}var display_data=!0;function plotSineWave(){return switchX(),y_val=amplitude*Math.sin(x/frequency),y_val>max_volt&&(max_volt=y_val,$("#max-voltage-input").val(y_val.toFixed(2))),y_val<min_volt&&(min_volt=y_val,$("#min-voltage-input").val(y_val.toFixed(2))),updateStats(),y_val}function plotSine(){return updateStats(),switchX(),$("#max-voltage-input").val(1),$("#min-voltage-input").val(1),x}function mean(){sum=0;for(const t of chart.data.datasets[0].data)sum+=t.y;return Math.round(sum/chart.data.datasets[0].data.length*100)/100}function updateStats(){$("#mean-voltage-input").val(mean())}function switchX(){x=x==amplitude?-1*amplitude:amplitude}function onReceive(t){window.myChart.config.data.datasets[t.index].data.push({x:t.timestamp,y:t.value}),window.myChart.update({preservation:!0})}function onData(){chart.clear(),chart.options.plugins.streaming.pause=!1,chart.update(),display_data=!0}function offData(){chart.options.plugins.streaming.pause=!0,chart.update(),display_data=!1}function convertToCSV(){const t=[];t.push(["Time,Voltage"].join(","));for(const e of chart.data.datasets[0].data)time=new Date(e.x).toString().replace("GMT-0500 (Central Daylight Time)",""),t.push([time,e.y].join(","));download(t.join("\n"))}const download=function(t){const e=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download","download.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)};